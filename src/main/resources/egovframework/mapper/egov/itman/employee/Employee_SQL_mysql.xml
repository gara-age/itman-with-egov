<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="employeeDAO">
    <sql id="employeeCondition">
        <where>
            E.DEL_YN    = 'N'
            AND E.GRO_IDX = #{searching.groIdx}
        <if test="searching.searchKeyword != null and searching.searchKeyword != ''">
        <choose>
                <when test="searching.searchCondition == 'empNum'">
                    AND E.EMP_NUM  LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                </when>
                <when test="searching.searchCondition == 'empName'">
                    AND E.EMP_NAME LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                </when>
                <when test="searching.searchCondition == 'empDiv'">
                    AND D.DIV_NAME  LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                </when>
                <otherwise>
                    AND (
                    E.EMP_NAME LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                    OR E.EMP_NUM  LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                    OR D.DIV_NAME LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                    )
                </otherwise>
            </choose>
        </if>

        </where>
    </sql>
    <select id="selectEmployeeList" parameterType="pagination" resultType="employeeVO">
        SELECT
        E.EMP_IDX      AS empIdx,
        E.EMP_NUM      AS empNum,
        E.EMP_NAME     AS empName,
        E.GRO_IDX      AS groIdx,
        E.DIV_IDX      AS divIdx,
        D.DIV_NAME     AS empDiv,
        P.POS_NAME     AS posName,
        E.EMP_MAIL     AS empMail,
        E.EMP_TEL      AS empTel,
        S.EMP_ST_NAME  AS empState
        FROM ITM_EMPLOYE E
        LEFT JOIN ITM_DIVISION  D ON D.DIV_IDX      = E.DIV_IDX
        LEFT JOIN ITM_POSITION  P ON P.POS_IDX      = E.POS_IDX
        LEFT JOIN ITM_EMP_STATE S ON S.EMP_ST_IDX   = E.EMP_ST_IDX
        <include refid="employeeCondition"/>

        LIMIT #{startList}, #{listSize}
    </select>

    <select id="selectEmployeeListCnt" parameterType="pagination" resultType="int">
        SELECT
        count(*)
        FROM
        ITM_EMPLOYE AS E
        LEFT JOIN ITM_DIVISION  D ON D.DIV_IDX      = E.DIV_IDX
        <include refid="employeeCondition"/>
    </select>

    <select id="selectEmployeeView" resultType="employeeVO" parameterType="employeeVO">
        SELECT
            E.EMP_IDX      AS empIdx,
            E.EMP_NUM      AS empNum,
            E.EMP_NAME     AS empName,
            E.GRO_IDX      AS groIdx,
            E.DIV_IDX      AS divIdx,
            E.POS_IDX      AS posIdx,
            E.EMP_ST_IDX   AS empStIdx,
            D.DIV_NAME     AS empDiv,
            P.POS_NAME     AS posName,
            E.EMP_MAIL     AS empMail,
            E.EMP_TEL      AS empTel,
            S.EMP_ST_NAME  AS empState
        FROM ITM_EMPLOYE AS E
                 LEFT JOIN ITM_DIVISION  D ON D.DIV_IDX      = E.DIV_IDX
                 LEFT JOIN ITM_POSITION  P ON P.POS_IDX      = E.POS_IDX
                 LEFT JOIN ITM_EMP_STATE S ON S.EMP_ST_IDX   = E.EMP_ST_IDX
        WHERE E.EMP_IDX = #{empIdx}
          AND E.DEL_YN = 'N'
    </select>

    <insert id="insertEmployee" parameterType="employeeVO">
        INSERT INTO ITM_EMPLOYE
        <trim prefix="(" suffix=")" suffixOverrides=",">
            GRO_IDX,
            EMP_NUM,
            EMP_NAME,
            <if test="empMail  != null and empMail != ''">EMP_MAIL,</if>
            <if test="empTel   != null and empTel != ''">EMP_TEL,</if>
            DIV_IDX,
            POS_IDX,
            EMP_ST_IDX,
            REG_DATE,
            REG_IDx
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            #{groIdx},
            #{empNum},
            #{empName},
            <if test="empMail  != null and empMail != ''">#{empMail},</if>
            <if test="empTel   != null and empTel != ''">#{empTel},</if>
            #{divIdx},
            #{posIdx},
            #{empStIdx},
            NOW(),
            #{regIdx},
        </trim>
    </insert>

    <update id="updateEmploTelInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            EMP_TEL = #{empTel},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>

    <update id="updateEmploNumInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            EMP_NUM = #{empNum},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>
    <update id="updateEmploDivisionInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            DIV_IDX = #{divIdx},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>
    <update id="updateEmploPosInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            POS_IDX = #{posIdx},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>
    <update id="updateEmploMailInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            EMP_MAIL = #{empMail},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>
    <update id="updateEmploNameInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            EMP_NAME = #{empName},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>
    <update id="updateEmploStateInfo" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            EMP_ST_IDX = #{empStIdx},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>

    <update id="deleteEmployee" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            DEL_YN = 'Y' ,
            DEL_DATE = NOW(),
            DEL_IDX = #{modIdx}
        WHERE
            EMP_IDX = #{empIdx}
    </update>

</mapper>