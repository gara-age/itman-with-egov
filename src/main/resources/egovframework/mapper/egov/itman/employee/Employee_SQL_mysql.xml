<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="employeeDAO">
    <select id="selectEmployeeList" resultType="employeeVO">
        <!--사번, 이름, 부서, 직위, 이메일, 휴대폰, 상태 -->
        SELECT
        EMP_IDX as empIdx,
        EMP_NUM as empNum,
        EMP_NAME as empName,
        (SELECT DIV_NAME FROM ITM_DIVISION AS D WHERE D.DIV_IDX = E.DIV_IDX) AS empDiv,
        (SELECT POS_NAME FROM ITM_POSITION AS P WHERE P.POS_IDX = E.POS_IDX) AS posName,
        EMP_MAIL as empMail,
        EMP_TEL as empTel,
        (SELECT EMP_ST_NAME FROM ITM_EMP_STATE AS S WHERE S.EMP_ST_IDX = E.EMP_ST_IDX) as empState
        FROM ITM_EMPLOYE AS E
        WHERE DEL_YN = 'N'
    </select>

    <select id="selectEmployeeView" resultType="employeeVO" parameterType="employeeVO">
        SELECT
            EMP_IDX AS empIdx,
            EMP_NUM AS empNum,
            EMP_NAME AS empName,
            (SELECT DIV_NAME FROM ITM_DIVISION AS D WHERE D.DIV_IDX = E.DIV_IDX) AS empDiv,
            (SELECT POS_NAME FROM ITM_POSITION AS P WHERE P.POS_IDX = E.POS_IDX) AS posName,
            EMP_MAIL AS empMail,
            EMP_TEL AS empTel,
            (SELECT EMP_ST_NAME FROM ITM_EMP_STATE AS S WHERE S.EMP_ST_IDX = E.EMP_ST_IDX) AS empState
        FROM ITM_EMPLOYE AS E
        WHERE EMP_IDX = #{empIdx}
          AND DEL_YN = 'N'
    </select>

    <insert id="insertEmployee" parameterType="employeeVO">
        INSERT INTO ITM_EMPLOYE
        <trim prefix="(" suffix=")" suffixOverrides=",">
            GRO_IDX,
            EMP_NUM,
            EMP_NAME,
            <if test="empMail  != null">EMP_MAIL,</if>
            <if test="empTel   != null">EMP_TEL,</if>
            <if test="divIdx   != null">DIV_IDX,</if>
            <if test="posIdx   != null">POS_IDX,</if>
            <if test="empStIdx != null">EMP_ST_IDX,</if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            1,
            #{empNum},
            #{empName},
            <if test="empMail  != null">#{empMail},</if>
            <if test="empTel   != null">#{empTel},</if>
            <if test="divIdx   != null">#{divIdx},</if>
            <if test="posIdx   != null">#{posIdx},</if>
            <if test="empStIdx != null">#{empStIdx},</if>
        </trim>
    </insert>

    <update id="deleteEmployee" parameterType="employeeVO">
        UPDATE
            ITM_EMPLOYE
        SET
            DEL_YN = 'Y'

        WHERE
            EMP_IDX = #{empIdx}
    </update>

</mapper>